<!DOCTYPE html>
<html lang="my">
<head>
  <!-- Myanmar Unicode font to prevent Zawgyi fallback conflicts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Myanmar:wght@400;600;700;800&display=swap" rel="stylesheet">

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <meta id="theme-meta" name="theme-color" content="#0b0c10"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

  <title>Shwe Calculator Pro</title>

  <!-- html2canvas (for "save as photo") -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>

  <link rel="manifest" href="manifest.json"/>
  <link rel="apple-touch-icon" href="icons/icon-192.png"/>
  <link rel="icon" href="icons/icon-192.png"/>

  <style>
    :root{
      /* Brand */
      --gold:#fcc103;
      --diamond:#b9f2ff;

      /* Dark theme (default) */
      --bg:#0b0c10;
      --card:#12141a;
      --input-bg:#0f1117;
      --text:#f5f6fa;
      --label-text:#a7adbd;
      --border:#242835;

      /* Semantic */
      --danger:#ff5a67;
      --success:#22c55e;

      /* System-safe areas */
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
      --safe-left: env(safe-area-inset-left);
      --safe-right: env(safe-area-inset-right);

      /* UI tokens */
      --radius-sm: 12px;
      --radius-md: 16px;
      --radius-lg: 20px;

      --shadow-sm: 0 10px 28px rgba(0,0,0,0.18);
      --shadow-md: 0 18px 56px rgba(0,0,0,0.30);

      --ring: 0 0 0 4px rgba(252,193,3,0.25);
      --ring-diamond: 0 0 0 4px rgba(185,242,255,0.22);

      --header-bg: rgba(18,20,26,0.78);
      --overlay: rgba(0,0,0,0.55);

      /* updated via JS */
      --header-h: 0px;
    }

    [data-theme="light"]{
      --bg:#f6f7fb;
      --card:#ffffff;
      --input-bg:#f2f4f8;
      --text:#0f172a;
      --label-text:#475569;
      --border:#d7dbe7;

      --shadow-sm: 0 10px 26px rgba(2,6,23,0.08);
      --shadow-md: 0 22px 56px rgba(2,6,23,0.12);

      --ring: 0 0 0 4px rgba(252,193,3,0.22);
      --ring-diamond: 0 0 0 4px rgba(185,242,255,0.22);

      --header-bg: rgba(255,255,255,0.86);
      --overlay: rgba(2,6,23,0.42);
    }

    *{ box-sizing:border-box; }
    html{
      height: 100%;
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
      scroll-behavior: smooth;
    }

    body{
      margin:0;
      font-family: "Noto Sans Myanmar", "Myanmar Text", "Pyidaungsu", "Padauk",
                   ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial,
                   "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(252,193,3,0.10), transparent 55%),
        radial-gradient(900px 500px at 110% 10%, rgba(185,242,255,0.10), transparent 55%),
        var(--bg);
      color: var(--text);
      line-height: 1.45;
      font-size: clamp(15px, 2.2vw, 16.5px);
      overflow-x: hidden;

      padding-left: var(--safe-left);
      padding-right: var(--safe-right);

      transition: background-color .25s ease, color .25s ease;
    }

    /* Force Unicode Myanmar font for Burmese language text (avoids Zawgyi fallback) */
    :lang(my), [lang="my"]{
      font-family: "Noto Sans Myanmar","Myanmar Text","Pyidaungsu","Padauk",
                   ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial,
                   "Apple Color Emoji","Segoe UI Emoji";
    }

    .app-wrapper{
      min-height: 100svh;
      display:flex;
      flex-direction:column;
    }

    header{
      position: sticky;
      top: 0;
      z-index: 900;

      background: var(--header-bg);
      -webkit-backdrop-filter: blur(14px);
      backdrop-filter: blur(14px);

      border-bottom: 1px solid var(--border);
      box-shadow: 0 6px 22px rgba(0,0,0,0.12);

      padding: calc(12px + var(--safe-top)) clamp(14px, 3.5vw, 20px) 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }

    header::after{
      content:"";
      position:absolute;
      left:0; right:0; bottom:0;
      height: 2px;
      background: linear-gradient(90deg, rgba(252,193,3,0.0), rgba(252,193,3,0.9), rgba(252,193,3,0.0));
      pointer-events:none;
    }

    .header-left{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .menu-btn{
      width: 42px;
      height: 42px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      color: var(--gold);
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
      transition: transform .12s ease, background .18s ease;
      font-size: 1.2rem;
    }
    [data-theme="light"] .menu-btn{
      background: rgba(2,6,23,0.04);
      border-color: rgba(2,6,23,0.06);
    }
    .menu-btn:active{ transform: scale(0.98); }

    #nav-title{
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      letter-spacing: 0.6px;
      font-weight: 900;
      font-size: 1.05rem;
    }

    .theme-toggle{
      width: 42px;
      height: 42px;
      display:grid;
      place-items:center;
      font-size: 1.2rem;
      cursor:pointer;
      border-radius: 14px;
      color: var(--gold);
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.08);
      transition: transform .12s ease, background .18s ease;
      user-select:none;
    }
    [data-theme="light"] .theme-toggle{
      background: rgba(2,6,23,0.04);
      border-color: rgba(2,6,23,0.06);
    }
    .theme-toggle:active{ transform: scale(0.98); }

    .container{
      width:100%;
      max-width: 560px;
      margin: 0 auto;
      padding: clamp(14px, 3.5vw, 22px);
      padding-bottom: calc(120px + var(--safe-bottom));
    }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 18px;
      box-shadow: var(--shadow-sm);
      margin-bottom: 16px;
    }

    h2{
      margin: 18px 0 10px;
      font-size: clamp(1.05rem, 2.6vw, 1.25rem);
      font-weight: 800;
      letter-spacing: .2px;
      color: var(--gold);
      display:flex;
      align-items:center;
      gap: 10px;
    }
    h2::before{
      content:"";
      width: 10px;
      height: 22px;
      border-radius: 999px;
      background: rgba(252,193,3,0.9);
      box-shadow: 0 10px 20px rgba(252,193,3,0.12);
    }

    .h2-diamond{
      color: var(--diamond);
    }
    .h2-diamond::before{
      background: rgba(185,242,255,0.9);
      box-shadow: 0 10px 20px rgba(185,242,255,0.12);
    }

    label{
      display:block;
      font-size: 0.95rem;
      color: var(--label-text);
      margin-bottom: 8px;
      font-weight: 750;
      letter-spacing: .1px;
    }
    .input-group label{
      font-size: 0.9rem;
      margin-bottom: 6px;
    }

    input, select{
      width:100%;
      min-height: 52px;
      padding: 14px 14px;
      background: var(--input-bg);
      border: 1.5px solid var(--border);
      border-radius: var(--radius-md);
      color: var(--text);
      outline: none;
      font-size: 17px; /* prevent iOS zoom */
      transition: border-color .18s ease, box-shadow .18s ease, transform .12s ease;
    }

    input::placeholder{
      color: color-mix(in srgb, var(--label-text) 75%, transparent);
    }

    input:focus, select:focus{
      border-color: var(--gold);
      box-shadow: var(--ring);
    }
    .diamond-focus:focus{
      border-color: var(--diamond);
      box-shadow: var(--ring-diamond);
    }

    /* Remove number spinners (cleaner UI) */
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"]{ -moz-appearance:textfield; }

    .grid-3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }
    .grid-2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    @media (max-width: 380px){
      .grid-3{ grid-template-columns: 1fr; }
      .grid-2{ grid-template-columns: 1fr; }
    }

    .btn-row{
      display:flex;
      gap: 10px;
      margin-top: 14px;
      flex-wrap: wrap;
    }
    .btn-row > button{ flex: 1 1 180px; }

    .btn-main{
      width:100%;
      min-height: 56px;
      padding: 16px 18px;
      background: var(--gold);
      color:#0b0c10;
      border:none;
      border-radius: var(--radius-lg);
      font-weight: 850;
      cursor:pointer;
      font-size: 1.08rem;
      letter-spacing: .2px;
      box-shadow: 0 14px 30px rgba(252,193,3,0.22);
      transition: transform .12s ease, filter .18s ease, box-shadow .18s ease;
    }
    .btn-main:hover{ filter: brightness(1.02); }
    .btn-main:active{ transform: translateY(1px) scale(0.99); }

    .btn-diamond{
      background: var(--diamond);
      color:#071018;
      box-shadow: 0 14px 30px rgba(185,242,255,0.20);
    }

    .btn-ghost{
      width:100%;
      min-height: 56px;
      padding: 16px 18px;
      background: transparent;
      color: var(--text);
      border: 1.6px solid var(--border);
      border-radius: var(--radius-lg);
      font-weight: 850;
      cursor:pointer;
      font-size: 1.02rem;
      transition: transform .12s ease, background .18s ease, border-color .18s ease;
    }
    .btn-ghost:hover{
      background: rgba(255,255,255,0.04);
      border-color: color-mix(in srgb, var(--border) 70%, var(--gold));
    }
    [data-theme="light"] .btn-ghost:hover{
      background: rgba(2,6,23,0.03);
    }
    .btn-ghost:active{ transform: translateY(1px) scale(0.99); }

    .btn-reset{
      width:100%;
      min-height: 56px;
      padding: 16px 18px;
      background: transparent;
      color: var(--danger);
      border: 1.6px solid rgba(255,90,103,0.7);
      border-radius: var(--radius-lg);
      font-weight: 850;
      cursor:pointer;
      font-size: 1.02rem;
      transition: transform .12s ease, background .18s ease, border-color .18s ease;
    }
    .btn-reset:hover{
      background: rgba(255,90,103,0.08);
      border-color: rgba(255,90,103,0.85);
    }
    .btn-reset:active{ transform: translateY(1px) scale(0.99); }

    .tab-container{
      display:flex;
      gap: 10px;
      margin-bottom: 14px;
    }
    .tab{
      flex:1;
      min-height: 48px;
      padding: 12px 12px;
      border: 1.5px solid var(--border);
      background: var(--input-bg);
      color: var(--text);
      cursor:pointer;
      border-radius: 999px;
      font-weight: 850;
      transition: background .18s ease, border-color .18s ease, transform .12s ease;
    }
    .tab:active{ transform: scale(0.99); }
    .tab.active{
      background: rgba(252,193,3,0.18);
      border-color: rgba(252,193,3,0.55);
      box-shadow: 0 10px 22px rgba(252,193,3,0.10);
    }

    .sidebar{
      height:100%;
      width:0;
      position:fixed;
      z-index:1000;
      top:0; left:0;

      background: var(--card);
      -webkit-backdrop-filter: blur(14px);
      backdrop-filter: blur(14px);

      overflow-x:hidden;
      transition: width .25s ease;
      padding-top: calc(60px + var(--safe-top));
      padding-bottom: calc(18px + var(--safe-bottom));
      border-right: 1px solid var(--border);
      box-shadow: 18px 0 60px rgba(0,0,0,0.35);
      overscroll-behavior: contain;
    }

    .sidebar a{
      padding: 14px 22px;
      text-decoration:none;
      font-size: 1.05rem;
      color: var(--text);
      display:block;
      border-bottom: 1px solid var(--border);
      transition: background .18s ease;
      cursor: pointer;
    }
    .sidebar a:hover{ background: rgba(255,255,255,0.04); }
    [data-theme="light"] .sidebar a:hover{ background: rgba(2,6,23,0.04); }

    .sidebar .close-btn{
      position:absolute;
      top: calc(10px + var(--safe-top));
      right: 18px;
      font-size: 35px;
      line-height: 1;
      text-decoration:none;
      border: none;
      background: transparent;
      color: var(--text);
      cursor:pointer;
      padding: 0;
    }

    .btn-master-reset{
      color: var(--danger) !important;
      font-weight: 900;
      border-top: 1px solid var(--border);
      margin-top: 14px;
    }

    .overlay{
      display:none;
      position:fixed;
      inset:0;
      background: var(--overlay);
      z-index: 999;
    }

    .hidden{ display:none; }

    .highlight-box{
      background: rgba(252,193,3,0.08);
      border: 1.5px solid rgba(252,193,3,0.42);
      padding: 16px;
      border-radius: var(--radius-lg);
      text-align:center;
      margin-top: 10px;
      box-shadow: 0 12px 24px rgba(252,193,3,0.08);
    }

    .ref-box{
      background: rgba(255,255,255,0.04);
      border: 1px dashed rgba(252,193,3,0.5);
      padding: 14px;
      border-radius: var(--radius-lg);
      margin-top: 14px;
      font-size: 0.92rem;
      line-height: 1.6;
      color: var(--label-text);
    }
    [data-theme="light"] .ref-box{ background: rgba(2,6,23,0.03); }

    .ref-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
      border-top: 1px solid var(--border);
      padding-top: 10px;
    }

    .res-row{
      display:flex;
      justify-content:space-between;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
      font-size: 1.02rem;
    }
    .val-highlight{ color: var(--gold); font-weight: 900; }

    .total-row{
      color: var(--gold);
      font-weight: 950;
      font-size: clamp(1.25rem, 3.2vw, 1.6rem);
      margin-top: 14px;
      background: rgba(252,193,3,0.12);
      border: 1px solid rgba(252,193,3,0.35);
      padding: 14px;
      border-radius: var(--radius-lg);
      text-align:center;
    }

    .main-ans{
      font-size: clamp(1.6rem, 5vw, 2.1rem);
      font-weight: 950;
      color: var(--gold);
      line-height: 1.15;
    }

    /* Focus-visible for keyboard users */
    :where(button, a, input, select, .tab, .theme-toggle, .menu-btn):focus-visible{
      outline: none;
      box-shadow: var(--ring);
      border-color: var(--gold);
    }

    @media (prefers-reduced-motion: reduce){
      *{ transition: none !important; animation: none !important; }
      html{ scroll-behavior: auto; }
    }
  </style>
</head>

<body data-theme="dark">
  <div class="app-wrapper">
    <div class="sidebar" id="mySidebar" aria-hidden="true">
      <button class="close-btn" type="button" onclick="closeNav()" aria-label="Close menu">Ã—</button>
      <div style="padding: 20px 25px;">
        <h3 style="color:var(--gold); margin:0;">á€›á€½á€¾á€±á€á€½á€€á€ºá€…á€€á€º</h3>
      </div>
      <a onclick="showView('price-calc')">ğŸ’° á€›á€½á€¾á€±á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸á€á€½á€€á€ºá€›á€”á€º</a>
      <a onclick="showView('purity-calc')">âš–ï¸ á€¡á€á€±á€«á€€á€ºá€á€»á€½á€á€º/á€¡á€›á€Šá€ºá€á€½á€€á€º</a>
      <a onclick="showView('diamond-calc')">ğŸ’ á€…á€­á€”á€ºá€”á€¾á€„á€·á€º á€›á€á€”á€¬á€á€½á€€á€ºá€›á€”á€º</a>
      <a onclick="showView('unit-converter')">âš–ï¸ á€¡á€œá€±á€¸á€á€»á€­á€”á€ºá€•á€¼á€±á€¬á€„á€ºá€¸á€›á€”á€º</a>
      <a onclick="showView('net-weight')">âš–ï¸ á€¡á€á€¬á€¸á€á€„á€ºá€¡á€œá€±á€¸á€á€»á€­á€”á€º</a>
      <a class="btn-master-reset" onclick="resetAllData()">âš ï¸ á€’á€±á€á€¬á€¡á€¬á€¸á€œá€¯á€¶á€¸á€–á€»á€€á€ºá€™á€Šá€º</a>
    </div>

    <div class="overlay" id="overlay" onclick="closeNav()" aria-hidden="true"></div>

    <header>
      <div class="header-left">
        <div class="menu-btn" onclick="openNav()" aria-label="Open menu" role="button" tabindex="0">â˜°</div>
        <span id="nav-title" style="color:var(--gold);">SHWE CALCULATOR PRO</span>
      </div>
      <div class="theme-toggle" id="theme-icon" onclick="toggleTheme()" aria-label="Toggle theme" role="button" tabindex="0">ğŸŒ™</div>
    </header>

    <div class="container">
      <!-- PRICE CALC -->
      <div id="price-calc-view">
        <h2>á€›á€½á€¾á€±á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸</h2>
        <div class="card">
          <label>á€šá€”á€±á€·á€•á€±á€«á€€á€ºá€ˆá€±á€¸ (á€€á€»á€•á€º)</label>
          <input id="GoldPrice" inputmode="numeric" placeholder="á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸á€‘á€Šá€·á€ºá€•á€«..." type="number"/>
        </div>

        <h2>á€›á€½á€¾á€±á€¡á€œá€±á€¸á€á€»á€­á€”á€º</h2>
        <div class="card grid-3">
          <div class="input-group">
            <label>á€€á€»á€•á€º</label>
            <input id="PKat" inputmode="numeric" oninput="autoCorrectGold('PKat','PPe','PYway')" type="number"/>
          </div>
          <div class="input-group">
            <label>á€•á€²</label>
            <input id="PPe" inputmode="numeric" oninput="autoCorrectGold('PKat','PPe','PYway')" type="number"/>
          </div>
          <div class="input-group">
            <label>á€›á€½á€±á€¸</label>
            <input id="PYway" inputmode="decimal" oninput="autoCorrectGold('PKat','PPe','PYway')" type="number"/>
          </div>
        </div>

        <h2>á€¡á€œá€»á€±á€¬á€·á€á€½á€€á€º</h2>
        <div class="card grid-3">
          <div class="input-group">
            <label>á€€á€»á€•á€º</label>
            <input id="RKat" inputmode="numeric" oninput="autoCorrectGold('RKat','RPae','RYway')" type="number"/>
          </div>
          <div class="input-group">
            <label>á€•á€²</label>
            <input id="RPae" inputmode="numeric" oninput="autoCorrectGold('RKat','RPae','RYway')" type="number"/>
          </div>
          <div class="input-group">
            <label>á€›á€½á€±á€¸</label>
            <input id="RYway" inputmode="decimal" oninput="autoCorrectGold('RKat','RPae','RYway')" type="number"/>
          </div>
        </div>

        <h2>á€œá€€á€ºá€ á€”á€¾á€„á€ºá€· á€€á€»á€±á€¬á€€á€ºá€–á€­á€¯á€¸</h2>
        <div class="card">
          <label>á€œá€€á€ºá€ (á€€á€»á€•á€º)</label>
          <input id="Smith" inputmode="numeric" style="margin-bottom:15px;" type="number"/>
          <label>á€€á€»á€±á€¬á€€á€ºá€–á€­á€¯á€¸ (á€€á€»á€•á€º)</label>
          <input id="StonePrice" inputmode="numeric" type="number"/>
        </div>

        <div class="btn-row">
          <button class="btn-main" type="button" onclick="calculatePrice()">á€á€½á€€á€ºá€á€»á€€á€ºá€™á€Šá€º</button>
          <button class="btn-reset" type="button" onclick="resetCalculator()">RESET</button>
        </div>
      </div>

      <!-- PURITY -->
      <div class="hidden" id="purity-calc-view">
        <h2>á€¡á€á€±á€«á€€á€ºá€á€»á€½á€á€ºá€á€½á€€á€ºá€…á€€á€º</h2>

        <div class="tab-container">
          <button class="tab active" id="tab-purity" type="button" onclick="switchPurityTab('purity')">á€¡á€›á€Šá€ºá€¡á€á€½á€±á€¸á€á€½á€€á€º</button>
          <button class="tab" id="tab-yield" type="button" onclick="switchPurityTab('yield')">á€¡á€á€¬á€¸á€á€„á€ºá€‘á€½á€€á€ºá€”á€¾á€¯á€”á€ºá€¸</button>
        </div>

        <div class="ref-box">
          <strong>ğŸ’¡ Density á€¡á€Šá€½á€¾á€”á€ºá€¸á€€á€­á€”á€ºá€¸á€™á€»á€¬á€¸</strong><br/>
          áá†á€•á€²á€›á€Šá€º á€›á€½á€¾á€±á€á€…á€ºá€€á€»á€•á€ºá€á€¬á€¸á€á€½á€„á€º <b>19.25</b> Density á€›á€¾á€­á€•á€¼á€®á€¸ áá…á€•á€²á€›á€Šá€ºá€á€Šá€º <b>17.8</b> Density á€–á€¼á€…á€ºá€•á€«á€á€Šá€ºá‹
          <div class="ref-grid">
            <span>áá„ á€•á€²á€›á€Šá€º â‰ˆ 16.84</span>
            <span>ááƒ á€•á€²á€›á€Šá€º â‰ˆ 15.64</span>
            <span>áá‚ á€•á€²á€›á€Šá€º â‰ˆ 14.43</span>
            <span>áá á€•á€²á€›á€Šá€º â‰ˆ 13.23</span>
          </div>
        </div>

        <div id="purity-sub-view" style="margin-top:20px;">
          <div class="card">
            <label>á€¡á€‘á€Šá€ºá€•á€»á€€á€º á€¡á€œá€±á€¸á€á€»á€­á€”á€º</label>
            <div class="grid-3">
              <div class="input-group"><label>á€€á€»á€•á€º</label><input id="p1-k" inputmode="numeric" oninput="autoCorrectGold('p1-k','p1-p','p1-y')" type="number"/></div>
              <div class="input-group"><label>á€•á€²</label><input id="p1-p" inputmode="numeric" oninput="autoCorrectGold('p1-k','p1-p','p1-y')" type="number"/></div>
              <div class="input-group"><label>á€›á€½á€±á€¸</label><input id="p1-y" inputmode="decimal" oninput="autoCorrectGold('p1-k','p1-p','p1-y')" type="number"/></div>
            </div>
          </div>

          <div class="card">
            <label>á€á€»á€½á€á€ºá€•á€¼á€®á€¸á€›á€›á€¾á€­á€á€±á€¬ á€¡á€á€±á€«á€€á€ºá€›á€½á€¾á€±</label>
            <div class="grid-3">
              <div class="input-group"><label>á€€á€»á€•á€º</label><input id="p2-k" inputmode="numeric" oninput="autoCorrectGold('p2-k','p2-p','p2-y')" type="number"/></div>
              <div class="input-group"><label>á€•á€²</label><input id="p2-p" inputmode="numeric" oninput="autoCorrectGold('p2-k','p2-p','p2-y')" type="number"/></div>
              <div class="input-group"><label>á€›á€½á€±á€¸</label><input id="p2-y" inputmode="decimal" oninput="autoCorrectGold('p2-k','p2-p','p2-y')" type="number"/></div>
            </div>
          </div>

          <button class="btn-main" type="button" onclick="calcPurity()">á€á€½á€€á€ºá€™á€Šá€º</button>
        </div>

        <div class="hidden" id="yield-sub-view" style="margin-top:20px;">
          <div class="card">
            <label>á€¡á€‘á€Šá€ºá€•á€»á€€á€º á€¡á€œá€±á€¸á€á€»á€­á€”á€º</label>
            <div class="grid-3">
              <div class="input-group"><label>á€€á€»á€•á€º</label><input id="y1-k" inputmode="numeric" oninput="autoCorrectGold('y1-k','y1-p','y1-y')" type="number"/></div>
              <div class="input-group"><label>á€•á€²</label><input id="y1-p" inputmode="numeric" oninput="autoCorrectGold('y1-k','y1-p','y1-y')" type="number"/></div>
              <div class="input-group"><label>á€›á€½á€±á€¸</label><input id="y1-y" inputmode="decimal" oninput="autoCorrectGold('y1-k','y1-p','y1-y')" type="number"/></div>
            </div>
          </div>

          <div class="card">
            <label>Density (á€…á€€á€ºá€•á€½á€­á€¯á€„á€·á€º)</label>
            <input id="y-den" placeholder="á€¥á€•á€™á€¬- 17.51" step="0.01" style="margin-bottom:15px;" type="number"/>
            <p style="text-align: center; margin: 10px 0; font-weight:bold;">- (á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º) -</p>
            <label>á€•á€²á€›á€Šá€º á€á€­á€œá€»á€¾á€„á€ºá€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€«</label>
            <input id="y-pe" placeholder="á€¥á€•á€™á€¬- 14.5" type="number"/>
          </div>

          <button class="btn-main" type="button" onclick="calcYield()">á€‘á€½á€€á€ºá€”á€¾á€¯á€”á€ºá€¸á€á€½á€€á€ºá€™á€Šá€º</button>
        </div>

        <div class="highlight-box hidden" id="purity-result" style="margin-top:20px;">
          <label id="p-res-label" style="color:var(--gold);">á€›á€œá€’á€º</label>
          <div class="main-ans" id="p-res-val">0.00</div>
          <div id="p-res-detail" style="margin-top:10px; font-size:1.1rem;">-</div>
        </div>
      </div>

      <!-- DIAMOND -->
      <div class="hidden" id="diamond-calc-view">
        <h2 class="h2-diamond">á€…á€­á€”á€ºá€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸</h2>
        <div class="card">
          <label>á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸á€á€á€ºá€™á€¾á€á€ºá€á€»á€€á€º</label>
          <select id="DiamondPriceType" onchange="updateEquivPrice()" style="margin-bottom:15px;">
            <option value="carat">á á€€á€¬á€›á€€á€º á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸ (Per Carat)</option>
            <option value="ratti">á á€›á€á€® á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸ (Per Ratti)</option>
          </select>

          <label>á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸ (á€€á€»á€•á€º)</label>
          <input class="diamond-focus" id="DiamondPrice" inputmode="numeric" oninput="updateEquivPrice()" placeholder="á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸á€‘á€Šá€·á€ºá€•á€«..." type="number"/>
          <div id="equivPriceDisplay" style="font-size: 0.95rem; color: var(--diamond); margin-top: 8px; font-style: italic;"></div>
        </div>

        <h2 class="h2-diamond">á€…á€­á€”á€ºá€¡á€œá€±á€¸á€á€»á€­á€”á€º</h2>
        <div class="card">
          <label>á€€á€¬á€›á€€á€º (Carat)</label>
          <input class="diamond-focus" id="DCt" inputmode="decimal" oninput="syncDiamondUnits('ct')" placeholder="0.00" type="number"/>

          <div style="margin: 15px 0; border-top: 1px solid var(--border); padding-top:15px;">
            <label>á€›á€á€® / á€—á€¼á€® / á€•á€­á€¯á€„á€ºá€¸ (Auto-Correcting)</label>
            <div class="grid-3">
              <div class="input-group"><label>á€›á€á€® (R)</label><input class="diamond-focus" id="DR" inputmode="decimal" oninput="syncDiamondUnits('unit')" type="number"/></div>
              <div class="input-group"><label>á€—á€¼á€® (B)</label><input class="diamond-focus" id="DB" inputmode="decimal" oninput="syncDiamondUnits('unit')" type="number"/></div>
              <div class="input-group"><label>á€•á€­á€¯á€„á€ºá€¸ (P)</label><input class="diamond-focus" id="DP" inputmode="decimal" oninput="syncDiamondUnits('unit')" type="number"/></div>
            </div>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn-main btn-diamond" type="button" onclick="calculateDiamondPrice()">á€á€½á€€á€ºá€á€»á€€á€ºá€™á€Šá€º</button>
          <button class="btn-reset" type="button" onclick="resetDiamond()">RESET</button>
        </div>
      </div>

      <!-- CONVERTER -->
      <div class="hidden" id="unit-converter-view">
        <h2>á€šá€°á€”á€…á€º á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€á€¼á€„á€ºá€¸</h2>
        <div class="card">
          <label>á€‚á€›á€™á€º (Grams)</label>
          <input id="gramsInput" inputmode="decimal" placeholder="á€‚á€›á€™á€º á€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€«..." type="number"/>

          <div class="grid-3" style="margin:20px 0;">
            <div class="input-group"><label>á€€á€»á€•á€º</label><input id="uKyat" inputmode="numeric" oninput="convertUnits('units')" type="number"/></div>
            <div class="input-group"><label>á€•á€²</label><input id="uPe" inputmode="numeric" oninput="convertUnits('units')" type="number"/></div>
            <div class="input-group"><label>á€›á€½á€±á€¸</label><input id="uYway" inputmode="decimal" oninput="convertUnits('units')" type="number"/></div>
          </div>

          <select id="standard" onchange="convertUnits('grams')">
            <option value="16.329325">á€›á€½á€¾á€±: Official (16.3293g)</option>
            <option value="16.606">á€›á€½á€¾á€±: Traditional (16.606g)</option>
          </select>
        </div>

        <h2>á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸á€…á€”á€…á€º á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€á€¼á€„á€ºá€¸</h2>
        <div class="card">
          <div class="grid-2">
            <div class="input-group">
              <label>á€…á€”á€…á€ºá€á€…á€º (16.3293g)</label>
              <input id="priceNew" inputmode="numeric" oninput="convertPriceSystem('new')" placeholder="á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸..." type="number"/>
            </div>
            <div class="input-group">
              <label>á€…á€”á€…á€ºá€Ÿá€±á€¬á€„á€ºá€¸ (16.606g)</label>
              <input id="priceOld" inputmode="numeric" oninput="convertPriceSystem('old')" placeholder="á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸..." type="number"/>
            </div>
          </div>
          <p style="font-size: 0.85rem; color: var(--label-text); margin-top: 15px; font-style: italic; text-align: center;">
            * á€…á€”á€…á€ºá€á€…á€ºá€á€¯á€á€¯á€á€½á€„á€º á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸á€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€«á€€ á€€á€»á€”á€ºá€á€…á€ºá€á€¯á€€á€­á€¯ á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€ºá€á€½á€€á€ºá€•á€±á€¸á€•á€«á€™á€Šá€ºá‹
          </p>
        </div>

        <div class="card" style="border-color: var(--diamond);">
          <label style="color:var(--diamond);">á€…á€­á€”á€º / á€›á€á€”á€¬ (Carat to Gram)</label>
          <div class="grid-3">
            <div style="grid-column: span 2;">
              <label>á€€á€¬á€›á€€á€º (Ct)</label>
              <input id="convCt" inputmode="decimal" oninput="convertDiamondUnits('ct')" type="number"/>
            </div>
            <div>
              <label>á€‚á€›á€™á€º (g)</label>
              <input id="convGm" inputmode="decimal" oninput="convertDiamondUnits('gm')" type="number"/>
            </div>
          </div>
        </div>

        <button class="btn-reset" type="button" onclick="resetConverter()">RESET</button>
      </div>

      <!-- NET WEIGHT -->
      <div class="hidden" id="net-weight-view">
        <h2>á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸á€¡á€œá€±á€¸á€á€»á€­á€”á€º (Total)</h2>
        <div class="card grid-3">
          <div class="input-group"><label>á€€á€»á€•á€º</label><input id="TKat" inputmode="numeric" oninput="autoCorrectGold('TKat','TPe','TYway'); calculateNetWeight();" type="number"/></div>
          <div class="input-group"><label>á€•á€²</label><input id="TPe" inputmode="numeric" oninput="autoCorrectGold('TKat','TPe','TYway'); calculateNetWeight();" type="number"/></div>
          <div class="input-group"><label>á€›á€½á€±á€¸</label><input id="TYway" inputmode="decimal" oninput="autoCorrectGold('TKat','TPe','TYway'); calculateNetWeight();" type="number"/></div>
        </div>

        <h2>á€”á€¾á€¯á€á€ºá€™á€Šá€·á€ºá€¡á€œá€±á€¸á€á€»á€­á€”á€º (Stone)</h2>
        <div class="card grid-3">
          <div class="input-group"><label>á€€á€»á€•á€º</label><input id="SKat" inputmode="numeric" oninput="autoCorrectGold('SKat','SPe','SYway'); calculateNetWeight();" type="number"/></div>
          <div class="input-group"><label>á€•á€²</label><input id="SPe" inputmode="numeric" oninput="autoCorrectGold('SKat','SPe','SYway'); calculateNetWeight();" type="number"/></div>
          <div class="input-group"><label>á€›á€½á€±á€¸</label><input id="SYway" inputmode="decimal" oninput="autoCorrectGold('SKat','SPe','SYway'); calculateNetWeight();" type="number"/></div>
        </div>

        <div class="highlight-box">
          <label style="color:var(--gold); text-align:center;">á€¡á€á€¬á€¸á€á€„á€ºá€›á€½á€¾á€±á€¡á€œá€±á€¸á€á€»á€­á€”á€º</label>
          <div class="main-ans" id="netDisplay">á€ á€€á€»á€•á€º á€ á€•á€² á€ á€›á€½á€±á€¸</div>
          <div id="netSubDisplay" style="color:var(--text); font-size:1.1rem; margin-top:10px;">(0.0000 á€€á€»á€•á€º)</div>
        </div>

        <button class="btn-reset" type="button" onclick="resetNetWeight()">RESET</button>
      </div>

      <!-- RESULT VIEW (shared) -->
      <div class="hidden" id="price-result-view">
        <div class="card" id="capture-area" style="background:var(--card);">
          <h2 id="res-title" style="text-align:center; border:none; color:var(--gold);">á€á€½á€€á€ºá€á€»á€€á€ºá€™á€¾á€¯á€™á€¾á€á€ºá€á€™á€ºá€¸</h2>
          <div id="res-list"></div>
        </div>

        <div class="btn-row">
          <button class="btn-main" type="button" onclick="saveAsPhoto()" style="background: var(--success); color: #071018;">ğŸ“· á€•á€¯á€¶á€¡á€–á€¼á€…á€ºá€á€­á€™á€ºá€¸á€™á€Šá€º</button>
          <button class="btn-ghost" id="res-back-btn" type="button" onclick="showView('price-calc')">á€”á€±á€¬á€€á€ºá€á€­á€¯á€·</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Theme ----------
    function applyTheme(theme){
      const body = document.body;
      const icon = document.getElementById('theme-icon');
      const meta = document.getElementById('theme-meta');

      body.setAttribute('data-theme', theme);

      if(theme === 'light'){
        icon.innerText = "â˜€ï¸";
        meta.setAttribute('content', '#ffffff');
      }else{
        icon.innerText = "ğŸŒ™";
        meta.setAttribute('content', '#0b0c10');
      }
      localStorage.setItem('theme', theme);
    }

    function toggleTheme() {
      const current = document.body.getAttribute('data-theme') || 'dark';
      applyTheme(current === 'dark' ? 'light' : 'dark');
    }

    // ---------- Persistent inputs ----------
    const inputs = document.querySelectorAll('input, select');
    inputs.forEach(input => {
      input.addEventListener('input', () => {
        if(input.id) localStorage.setItem(input.id, input.value);
      });
    });

    // ---------- Sidebar ----------
    function openNav() {
      document.getElementById("mySidebar").style.width = "280px";
      document.getElementById("overlay").style.display = "block";
      document.getElementById("mySidebar").setAttribute('aria-hidden','false');
      document.getElementById("overlay").setAttribute('aria-hidden','false');
    }
    function closeNav() {
      document.getElementById("mySidebar").style.width = "0";
      document.getElementById("overlay").style.display = "none";
      document.getElementById("mySidebar").setAttribute('aria-hidden','true');
      document.getElementById("overlay").setAttribute('aria-hidden','true');
    }

    // Close menu by ESC
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape') closeNav();
    });

    // Improve mobile: update header height CSS var (used for sticky elements in future)
    function setHeaderHeightVar() {
      const header = document.querySelector('header');
      if (!header) return;
      const h = Math.ceil(header.getBoundingClientRect().height);
      document.documentElement.style.setProperty('--header-h', h + 'px');
    }

    // ---------- View routing ----------
    const VIEW_TITLES = {
      'price-calc': { text: 'SHWE CALCULATOR PRO', colorVar: '--gold' },
      'purity-calc': { text: 'PURITY CALCULATOR', colorVar: '--gold' },
      'diamond-calc': { text: 'DIAMOND CALCULATOR', colorVar: '--diamond' },
      'unit-converter': { text: 'UNIT CONVERTER', colorVar: '--gold' },
      'net-weight': { text: 'NET WEIGHT', colorVar: '--gold' },
      'price-result': { text: 'RESULT', colorVar: '--gold' }
    };

    function showView(view) {
      const ids = ['price-calc-view', 'diamond-calc-view', 'unit-converter-view', 'net-weight-view', 'price-result-view', 'purity-calc-view'];
      ids.forEach(v => {
        const el = document.getElementById(v);
        if(el) el.classList.add('hidden');
      });

      const target = document.getElementById(view + '-view');
      if (target) target.classList.remove('hidden');

      const title = document.getElementById('nav-title');
      const cfg = VIEW_TITLES[view] || VIEW_TITLES['price-calc'];
      title.innerText = cfg.text;
      title.style.color = `var(${cfg.colorVar})`;

      closeNav();
      window.scrollTo({top:0, left:0, behavior:'smooth'});
    }

    // ---------- Math helpers ----------
    function toDecimal(k, p, y) { return (parseFloat(k)||0) + ((parseFloat(p)||0)/16) + ((parseFloat(y)||0)/128); }

    function fromDecimal(decimal) {
      let k = Math.floor(decimal + 0.0000001);
      let remPe = (decimal - k) * 16;
      let p = Math.floor(remPe + 0.0000001);
      let y = parseFloat(((remPe - p) * 8).toFixed(2));
      if(y >= 8) { p++; y = 0; }
      if(p >= 16) { k++; p = 0; }
      return `${k} á€€á€»á€•á€º ${p} á€•á€² ${y} á€›á€½á€±á€¸`;
    }

    function autoCorrectGold(idK, idP, idY) {
      let k = parseFloat(document.getElementById(idK).value) || 0;
      let p = parseFloat(document.getElementById(idP).value) || 0;
      let y = parseFloat(document.getElementById(idY).value) || 0;

      if (y >= 8) {
        p += Math.floor(y / 8);
        y = parseFloat((y % 8).toFixed(2));
        document.getElementById(idP).value = p;
        document.getElementById(idY).value = y || "";
      }
      if (p >= 16) {
        k += Math.floor(p / 16);
        p = p % 16;
        document.getElementById(idK).value = k;
        document.getElementById(idP).value = p || "";
      }
    }

    // ---------- Conversions ----------
    function convertPriceSystem(mode) {
      const ratio = 16.606 / 16.329325;
      const pNew = document.getElementById('priceNew');
      const pOld = document.getElementById('priceOld');

      if (mode === 'new') {
        const val = parseFloat(pNew.value) || 0;
        pOld.value = val > 0 ? Math.round(val * ratio) : "";
      } else {
        const val = parseFloat(pOld.value) || 0;
        pNew.value = val > 0 ? Math.round(val / ratio) : "";
      }
    }

    // ---------- Purity ----------
    function switchPurityTab(type) {
      document.getElementById('tab-purity').classList.toggle('active', type === 'purity');
      document.getElementById('tab-yield').classList.toggle('active', type === 'yield');
      document.getElementById('purity-sub-view').classList.toggle('hidden', type !== 'purity');
      document.getElementById('yield-sub-view').classList.toggle('hidden', type !== 'yield');
      document.getElementById('purity-result').classList.add('hidden');
    }

    function calcPurity() {
      let raw = toDecimal(document.getElementById('p1-k').value, document.getElementById('p1-p').value, document.getElementById('p1-y').value);
      let pure = toDecimal(document.getElementById('p2-k').value, document.getElementById('p2-p').value, document.getElementById('p2-y').value);
      if(raw <= 0 || pure <= 0) return alert("á€¡á€œá€±á€¸á€á€»á€­á€”á€ºá€™á€¾á€”á€ºá€€á€”á€ºá€…á€½á€¬á€‘á€Šá€·á€ºá€•á€«á‹");
      let peYee = (pure / raw) * 16;
      let density = (pure / raw) * 19.32;
      document.getElementById('purity-result').classList.remove('hidden');
      document.getElementById('p-res-label').innerText = "á€á€½á€€á€ºá€á€»á€€á€ºá€›á€›á€¾á€­á€á€±á€¬ á€›á€½á€¾á€±á€¡á€›á€Šá€ºá€¡á€á€½á€±á€¸";
      document.getElementById('p-res-val').innerText = `${peYee.toFixed(2)} á€•á€²á€›á€Šá€º`;
      document.getElementById('p-res-detail').innerText = `Density (á€…á€€á€ºá€•á€½á€­á€¯á€„á€·á€º): ${density.toFixed(2)}`;
    }

    function calcYield() {
      let raw = toDecimal(document.getElementById('y1-k').value, document.getElementById('y1-p').value, document.getElementById('y1-y').value);
      let den = parseFloat(document.getElementById('y-den').value);
      let pe = parseFloat(document.getElementById('y-pe').value);
      let resultKyat = 0;
      if(den > 0) resultKyat = (den / 19.32) * raw;
      else if(pe > 0) resultKyat = (pe / 16) * raw;
      else return alert("Density (á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º) á€•á€²á€›á€Šá€º á€á€…á€ºá€á€¯á€á€¯á€‘á€Šá€·á€ºá€•á€«á‹");
      document.getElementById('purity-result').classList.remove('hidden');
      document.getElementById('p-res-label').innerText = "á€•á€¼á€”á€ºá€›á€™á€Šá€·á€º á€¡á€á€±á€«á€€á€ºá€›á€½á€¾á€±á€•á€™á€¬á€";
      document.getElementById('p-res-val').innerText = fromDecimal(resultKyat);
      document.getElementById('p-res-detail').innerText = `á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸á€’á€á€™á€€á€­á€”á€ºá€¸: ${resultKyat.toFixed(6)} á€€á€»á€•á€º`;
    }

    // ---------- Diamond ----------
    function updateEquivPrice() {
      const price = parseFloat(document.getElementById('DiamondPrice').value) || 0;
      const type = document.getElementById('DiamondPriceType').value;
      const display = document.getElementById('equivPriceDisplay');
      if (price === 0) { display.innerText = ""; return; }
      if (type === 'carat') display.innerText = `â‰ˆ ${Math.round(price / 1.1).toLocaleString()} á€€á€»á€•á€º (á á€›á€á€®á€œá€»á€¾á€„á€º)`;
      else display.innerText = `â‰ˆ ${Math.round(price * 1.1).toLocaleString()} á€€á€»á€•á€º (á á€€á€¬á€›á€€á€ºá€œá€»á€¾á€„á€º)`;
    }

    function syncDiamondUnits(mode) {
      let dr = document.getElementById('DR'), db = document.getElementById('DB'), dp = document.getElementById('DP'), dct = document.getElementById('DCt');
      if (mode === 'ct') {
        const ct = parseFloat(dct.value) || 0;
        const totalRatti = ct * 1.1;
        const r = Math.floor(totalRatti + 0.00001);
        const remB = (totalRatti - r) * 20;
        const b = Math.floor(remB + 0.00001);
        const p = parseFloat(((remB - b) * 8).toFixed(2));
        dr.value = r || ""; db.value = b || ""; dp.value = p > 0 ? p : "";
      } else {
        let r = parseFloat(dr.value) || 0, b = parseFloat(db.value) || 0, p = parseFloat(dp.value) || 0;
        if (p >= 8) { b += Math.floor(p / 8); p = parseFloat((p % 8).toFixed(2)); db.value = b; dp.value = p > 0 ? p : ""; }
        if (b >= 20) { r += Math.floor(b / 20); b = b % 20; dr.value = r; db.value = b > 0 ? b : ""; }
        const totalRatti = r + (b / 20) + (p / 160);
        dct.value = (totalRatti / 1.1).toFixed(4);
      }
    }

    function calculateDiamondPrice() {
      const price = parseFloat(document.getElementById('DiamondPrice').value) || 0;
      const type = document.getElementById('DiamondPriceType').value;
      const ct = parseFloat(document.getElementById('DCt').value) || 0;
      const r = parseFloat(document.getElementById('DR').value) || 0;
      const b = parseFloat(document.getElementById('DB').value) || 0;
      const p = parseFloat(document.getElementById('DP').value) || 0;
      const totalRatti = r + (b / 20) + (p / 160);
      let total = (type === 'carat') ? (ct * price) : (totalRatti * price);

      document.getElementById('res-title').innerText = "á€…á€­á€”á€º/á€›á€á€”á€¬ á€á€½á€€á€ºá€á€»á€€á€ºá€™á€¾á€¯";
      document.getElementById('res-title').style.color = "var(--diamond)";
      document.getElementById('res-back-btn').onclick = () => showView('diamond-calc');

      document.getElementById('res-list').innerHTML = `
        <div class="res-row"><span>á€á€á€ºá€™á€¾á€á€ºá€ˆá€±á€¸</span><span style="color:var(--diamond)">${price.toLocaleString()}</span></div>
        <div class="res-row"><span>á€¡á€œá€±á€¸á€á€»á€­á€”á€º (Ct)</span><span>${ct} Carat</span></div>
        <div class="res-row"><span>á€¡á€œá€±á€¸á€á€»á€­á€”á€º (R)</span><span>${r}R ${b}B ${p}P</span></div>
        <div class="res-row total-row" style="color:var(--diamond); background:rgba(185,242,255,0.1); border-color:var(--diamond);">
          <span>${Math.round(total).toLocaleString()} á€€á€»á€•á€º</span>
        </div>
      `;
      showView('price-result');
    }

    // ---------- Gold price total ----------
    function calculatePrice() {
      const getVal = (id) => parseFloat(document.getElementById(id).value) || 0;
      const price = getVal('GoldPrice');
      const pk = getVal('PKat'), pp = getVal('PPe'), py = getVal('PYway');
      const rk = getVal('RKat'), rp = getVal('RPae'), ry = getVal('RYway');
      const goldKyat = toDecimal(pk, pp, py);
      const redKyat = toDecimal(rk, rp, ry);
      const smith = getVal('Smith'), stone = getVal('StonePrice');
      const total = (goldKyat * price) + (redKyat * price) + smith + stone;

      document.getElementById('res-title').innerText = "á€›á€½á€¾á€±á€á€½á€€á€ºá€á€»á€€á€ºá€™á€¾á€¯á€™á€¾á€á€ºá€á€™á€ºá€¸";
      document.getElementById('res-title').style.color = "var(--gold)";
      document.getElementById('res-back-btn').onclick = () => showView('price-calc');

      document.getElementById('res-list').innerHTML = `
        <div class="res-row"><span>á€šá€”á€±á€·á€›á€½á€¾á€±á€ˆá€±á€¸</span><span class="val-highlight">${price.toLocaleString()} á€€á€»á€•á€º</span></div>

        <div class="res-row" style="flex-direction: column; align-items: flex-start; gap: 4px;">
          <div style="display: flex; justify-content: space-between; width: 100%;">
            <span>á€›á€½á€¾á€±á€–á€­á€¯á€¸</span><span class="val-highlight">${Math.round(goldKyat * price).toLocaleString()}</span>
          </div>
          <span style="font-size: 0.9rem; color: var(--label-text);">(á€¡á€œá€±á€¸á€á€»á€­á€”á€º: ${pk}K ${pp}P ${py}Y)</span>
        </div>

        <div class="res-row" style="flex-direction: column; align-items: flex-start; gap: 4px;">
          <div style="display: flex; justify-content: space-between; width: 100%;">
            <span>á€œá€»á€±á€¬á€·á€á€½á€€á€ºá€–á€­á€¯á€¸</span><span class="val-highlight">${Math.round(redKyat * price).toLocaleString()}</span>
          </div>
          <span style="font-size: 0.9rem; color: var(--label-text);">(á€¡á€œá€±á€¸á€á€»á€­á€”á€º: ${rk}K ${rp}P ${ry}Y)</span>
        </div>

        <div class="res-row"><span>á€œá€€á€ºá€ + á€€á€»á€±á€¬á€€á€º</span><span>${(smith + stone).toLocaleString()}</span></div>
        <div class="res-row total-row"><span>á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ - ${Math.round(total).toLocaleString()} á€€á€»á€•á€º</span></div>
      `;
      showView('price-result');
    }

    // ---------- Net weight ----------
    function calculateNetWeight() {
      const tk = parseFloat(document.getElementById('TKat').value) || 0, tp = parseFloat(document.getElementById('TPe').value) || 0, ty = parseFloat(document.getElementById('TYway').value) || 0;
      const sk = parseFloat(document.getElementById('SKat').value) || 0, sp = parseFloat(document.getElementById('SPe').value) || 0, sy = parseFloat(document.getElementById('SYway').value) || 0;
      const netDec = Math.max(0, toDecimal(tk, tp, ty) - toDecimal(sk, sp, sy));
      document.getElementById('netDisplay').innerText = fromDecimal(netDec);
      document.getElementById('netSubDisplay').innerText = `(${netDec.toFixed(4)} á€€á€»á€•á€º)`;
    }

    // ---------- Unit converter ----------
    function convertUnits(source) {
      const factor = parseFloat(document.getElementById('standard').value);
      let kyatDec = 0;

      if (source === 'grams') {
        kyatDec = (parseFloat(document.getElementById('gramsInput').value) || 0) / factor;
      } else {
        autoCorrectGold('uKyat', 'uPe', 'uYway');
        kyatDec = toDecimal(document.getElementById('uKyat').value, document.getElementById('uPe').value, document.getElementById('uYway').value);
      }

      if (source === 'grams') {
        let parts = fromDecimal(kyatDec).match(/\d+(\.\d+)?/g);
        document.getElementById('uKyat').value = parts[0];
        document.getElementById('uPe').value = parts[1];
        document.getElementById('uYway').value = parts[2];
      } else {
        document.getElementById('gramsInput').value = (kyatDec * factor).toFixed(3);
      }
    }

    function convertDiamondUnits(mode) {
      if(mode === 'ct') {
        const ct = parseFloat(document.getElementById('convCt').value) || 0;
        document.getElementById('convGm').value = (ct * 0.2).toFixed(4);
      } else {
        const gm = parseFloat(document.getElementById('convGm').value) || 0;
        document.getElementById('convCt').value = (gm / 0.2).toFixed(4);
      }
    }

    // ---------- Reset helpers ----------
    function resetAllData() {
      if (confirm("á€’á€±á€á€¬á€¡á€¬á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ á€–á€»á€€á€ºá€•á€…á€ºá€›á€”á€º á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?")) {
        document.querySelectorAll('input').forEach(i => i.value = "");
        localStorage.clear();
        if(document.getElementById('netDisplay')) document.getElementById('netDisplay').innerText = "á€ á€€á€»á€•á€º á€ á€•á€² á€ á€›á€½á€±á€¸";
        if(document.getElementById('netSubDisplay')) document.getElementById('netSubDisplay').innerText = "(0.0000 á€€á€»á€•á€º)";
        if(document.getElementById('purity-result')) document.getElementById('purity-result').classList.add('hidden');
        updateEquivPrice();
        closeNav();
        alert("á€’á€±á€á€¬á€¡á€¬á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ á€–á€»á€€á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹");
      }
    }

    function resetCalculator() {
      document.querySelectorAll('#price-calc-view input').forEach(i => { i.value = ""; if(i.id) localStorage.removeItem(i.id); });
    }
    function resetDiamond() {
      document.querySelectorAll('#diamond-calc-view input').forEach(i => { i.value = ""; if(i.id) localStorage.removeItem(i.id); });
      updateEquivPrice();
    }
    function resetConverter() {
      document.querySelectorAll('#unit-converter-view input').forEach(i => { i.value = ""; if(i.id) localStorage.removeItem(i.id); });
    }
    function resetNetWeight() {
      ['TKat','TPe','TYway','SKat','SPe','SYway'].forEach(id => { document.getElementById(id).value = ""; localStorage.removeItem(id); });
      calculateNetWeight();
    }

    // ---------- Save as photo ----------
    function saveAsPhoto() {
      const cardBg = getComputedStyle(document.documentElement).getPropertyValue('--card').trim();
      html2canvas(document.getElementById("capture-area"), { backgroundColor: cardBg, scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = `ShweCalc_${Date.now()}.png`;
        link.href = canvas.toDataURL();
        link.click();
      });
    }

    // ---------- Init ----------
    window.addEventListener('load', () => {
      // Theme: saved > system preference > dark
      const savedTheme = localStorage.getItem('theme');
      const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
      applyTheme(savedTheme || (prefersLight ? 'light' : 'dark'));

      // restore inputs
      inputs.forEach(input => {
        const savedValue = localStorage.getItem(input.id);
        if (savedValue !== null && savedValue !== undefined && input.id) input.value = savedValue;
      });

      // calculators needing initial refresh
      calculateNetWeight();
      updateEquivPrice();

      // auto convert grams typing
      const grams = document.getElementById('gramsInput');
      if (grams) grams.addEventListener('input', () => convertUnits('grams'));

      setHeaderHeightVar();
      window.addEventListener('resize', setHeaderHeightVar);
    });
  </script>

  <script>
    // PWA: register Service Worker (requires HTTPS or localhost)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(() => {});
      });
    }
  </script>
</body>
</html>
